(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{83:function(e,t,n){"use strict";n.r(t);var r,c=n(25),a=n(0),o=n.n(a),i=n(30),s=n.n(i),u=n(10),l=n(3),d=n(6),p=n(4);!function(e){e.AUTH_ATTEMPT="auth_attempt",e.AUTH_SUCCESS="auth_success",e.AUTH_ERROR="auth_error",e.LOGOUT_ATTEMPT="logout_attempt",e.LOGOUT_SUCCESS="logout_success",e.LOGOUT_ERROR="logout_error"}(r||(r={}));var h,f=function(e,t){switch(t.type){case r.AUTH_ATTEMPT:return Object(l.a)(Object(l.a)({},e),{},{isLoading:!0});case r.AUTH_SUCCESS:return Object(l.a)(Object(l.a)({},e),{},{isLoading:!1,isAuthenticated:!0,currentUser:t.payload});case r.AUTH_ERROR:return Object(l.a)(Object(l.a)({},e),{},{isLoading:!1,isAuthenticated:!1,currentUser:null});case r.LOGOUT_ATTEMPT:return Object(l.a)(Object(l.a)({},e),{},{isLoading:!0});case r.LOGOUT_SUCCESS:case r.LOGOUT_ERROR:return Object(l.a)(Object(l.a)({},e),{},{isLoading:!1,isAuthenticated:!1,currentUser:null});default:throw new Error("Invalid action type")}},b=n(7),j=n.n(b),g=n(9),x=n(18),m=n.n(x),O=n(50),v=Object(l.a)({colors:{accent100:"#786cff",accent200:"#5b4dfd",accent300:"#463bc3",white:"#ffffff",grey100:"#c9d6e2",grey200:"#607283",grey300:"#242f3b",grey400:"#141c23",grey500:"#0d1217",grey600:"#000000"},space:{1:"4px",2:"8px",3:"16px",4:"24px",5:"32px",6:"40px",7:"48px",8:"56px",9:"64px"},radii:{1:"3px",2:"5px"}},{fonts:{coreFontFamily:"Heeboo"},fontSizes:{heading1:"28px",heading2:"20px",paragraph:"14px",small:"12px"},fontWeights:{regular:"400",bold:"700"},lineHeights:{heading1:"42px",heading2:"30px",paragraph:"21px",small:"18px"},letterSpacings:{heading1:"0px",heading2:"0px",paragraph:"0px",small:"0.5px"}}),y=Object(O.a)({theme:v,utils:{bd:function(e){return function(e){return{border:"1px solid ".concat(e)}}},px:function(e){return function(e){return{paddingLeft:e,paddingRight:e}}},py:function(e){return function(e){return{paddingTop:e,paddingBottom:e}}},mx:function(e){return function(e){return{marginLeft:e,marginRight:e}}},my:function(e){return function(e){return{marginTop:e,marginBottom:e}}},linearGradient:function(e){return function(e){return{backgroundImage:"linear-gradient(".concat(e,")")}}}}}),C=y.styled,w=(y.css,y.global),k=y.keyframes,$=C("div",{boxSizing:"border-box"}),T=n(1),S=C("button",{fontSize:"$small",lineHeight:"$small",fontWeight:"$bold",letterSpacing:"$small",color:"$white",px:"$6",py:"$2",transition:"0.2s",borderRadius:"$1",textDecoration:"none","&:focus":{outline:"none"},variants:{emphasis:{high:{backgroundColor:"$accent200",bd:"$accent200",transition:"0.2s","&:hover":{backgroundColor:"$accent300",cursor:"pointer",borderColor:"$accent300"},"&:focus":{boxShadow:"0px 0px 0px 1px $colors$accent100",textDecoration:"underline",textUnderlineOffset:"3px"},"&:active":{boxShadow:"0px 0px 0px 1px $colors$accent100"}},low:{backgroundColor:"$grey300",bd:"$grey300",color:"$grey100","&:hover":{backgroundColor:"$grey200",cursor:"pointer",borderColor:"$grey200"},"&:focus":{boxShadow:"0px 0px 0px 1px $colors$grey100",textDecoration:"underline"},"&:active":{boxShadow:"0px 0px 0px 1px $colors$grey100"}}},fullWidth:{true:{width:"100%"}}}}),U=function(e){var t=e.children,n=e.to,r=e.emphasis,a=void 0===r?"high":r,o=e.fullWidth,i=void 0!==o&&o,s=e.css,u=Object(d.a)(e,["children","to","emphasis","fullWidth","css"]);return n?Object(T.jsx)(c.b,{to:n,style:{textDecoration:"none"},children:Object(T.jsx)(S,{as:"span",css:s,fullWidth:i,emphasis:a,children:t})}):Object(T.jsx)(S,Object(l.a)(Object(l.a)({css:s,emphasis:a,fullWidth:i},u),{},{children:t}))},E=C($,{padding:"$3",backgroundColor:"$grey400",borderRadius:"$2"}),R=o.a.forwardRef((function(e,t){var n=e.children,r=Object(d.a)(e,["children"]);return Object(T.jsx)(E,Object(l.a)(Object(l.a)({},r),{},{children:n}))})),_=C("h1",{margin:"0px",variants:{size:{h1:{fontSize:"$heading1",fontWeight:"$bold",lineHeight:"$heading1",color:"$grey100"},h2:{fontSize:"$heading2",fontWeight:"$bold",lineHeight:"$heading2",color:"$grey100"}}}}),A=function(e){var t=e.children,n=e.size,r=void 0===n?"h1":n,c=e.css;return Object(T.jsx)(_,{as:r,css:c,size:r,children:t})},P=C("p",{margin:"0px",fontWeight:"$regular",color:"$grey100",variants:{size:{paragraph:{fontSize:"$paragraph",lineHeight:"$paragraph"},small:{fontSize:"$small",lineHeight:"$small"}},bold:{true:{fontWeight:"$bold"}}}}),L=function(e){var t=e.children,n=e.bold,r=void 0!==n&&n,c=e.size,a=void 0===c?"paragraph":c,o=e.css;return Object(T.jsx)(P,{css:o,size:a,bold:r,children:t})},I=n(29),D=n(31),z=C($,{position:"relative",display:"inline-block"}),G=C(D.c,{display:"inline-flex",alignItems:"center",justifyContent:"center",verticalAlign:"middle",overflow:"hidden",userSelect:"none",variants:{size:{small:{width:"44px",height:"44px",borderRadius:"18px"},medium:{width:"52px",height:"52px",borderRadius:"22px"}}}}),N=C(D.b,{width:"100%",height:"100%",objectFit:"cover"}),B=C(D.a,{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"$accent100",color:"$white"}),H=C($,{position:"absolute",height:"14px",width:"14px",backgroundColor:"#9DFF7A",bottom:-2,right:-2,borderRadius:"100000px",bd:"$grey500",borderWidth:"2px"}),M=function(e){var t=e.css,n=e.imageSrc,r=e.size,c=void 0===r?"small":r,a=e.status,o=e.name;return Object(T.jsxs)(z,{css:t,children:[Object(T.jsxs)(G,{size:c,children:[Object(T.jsx)(N,{src:n}),Object(T.jsx)(B,{delayMs:1e3,children:function(e){var t=e.split(" "),n=t[0].substring(0,1).toUpperCase();return t.length>1&&(n+=t[t.length-1].substring(0,1).toUpperCase()),n}(o)})]}),a&&Object(T.jsx)(H,{})]})},W={chevronDown:"M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z",plus:"M8 2.75C8 2.47386 7.77614 2.25 7.5 2.25C7.22386 2.25 7 2.47386 7 2.75V7H2.75C2.47386 7 2.25 7.22386 2.25 7.5C2.25 7.77614 2.47386 8 2.75 8H7V12.25C7 12.5261 7.22386 12.75 7.5 12.75C7.77614 12.75 8 12.5261 8 12.25V8H12.25C12.5261 8 12.75 7.77614 12.75 7.5C12.75 7.22386 12.5261 7 12.25 7H8V2.75Z",spyGlass:"M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159C8.53901 10.6318 7.56251 11 6.5 11C4.01472 11 2 8.98528 2 6.5C2 4.01472 4.01472 2 6.5 2C8.98528 2 11 4.01472 11 6.5C11 7.56251 10.6318 8.53901 10.0159 9.30884L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L9.30884 10.0159Z",play:"M3.24182 2.32181C3.3919 2.23132 3.5784 2.22601 3.73338 2.30781L12.7334 7.05781C12.8974 7.14436 13 7.31457 13 7.5C13 7.68543 12.8974 7.85564 12.7334 7.94219L3.73338 12.6922C3.5784 12.774 3.3919 12.7687 3.24182 12.6782C3.09175 12.5877 3 12.4252 3 12.25V2.75C3 2.57476 3.09175 2.4123 3.24182 2.32181ZM4 3.57925V11.4207L11.4288 7.5L4 3.57925Z",pause:"M6.04995 2.74998C6.04995 2.44623 5.80371 2.19998 5.49995 2.19998C5.19619 2.19998 4.94995 2.44623 4.94995 2.74998V12.25C4.94995 12.5537 5.19619 12.8 5.49995 12.8C5.80371 12.8 6.04995 12.5537 6.04995 12.25V2.74998ZM10.05 2.74998C10.05 2.44623 9.80371 2.19998 9.49995 2.19998C9.19619 2.19998 8.94995 2.44623 8.94995 2.74998V12.25C8.94995 12.5537 9.19619 12.8 9.49995 12.8C9.80371 12.8 10.05 12.5537 10.05 12.25V2.74998Z"},Y=C("svg",{height:"20px",width:"20px"}),F=o.a.forwardRef((function(e,t){var n=e.fill,r=void 0===n?"#fff":n,c=e.icon,a=Object(d.a)(e,["fill","icon"]);return Object(T.jsx)(Y,Object(l.a)(Object(l.a)({viewBox:"0 0 15 15",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},a),{},{ref:t,children:Object(T.jsx)("path",{fill:r,d:W[c],fillRule:"evenodd"})}))})),Q=C(I.d,{display:"inline-flex",backgroundColor:"transparent",border:"none",marginLeft:"$3",padding:"0px",cursor:"pointer",'&[data-state="open"]':{"& svg":{transform:"rotate(180deg)"}}}),V=C(I.a,{minWidth:"85px",backgroundColor:"$grey400",bd:"$grey300",borderRadius:"$2",padding:"$1",marginTop:"$2"}),q=C(I.b,{fontSize:"$small",fontWeight:"$regular",color:"$grey200",px:"$2",py:"$1",borderRadius:"$2",cursor:"pointer","&:focus":{outline:"none",backgroundColor:"$grey300",color:"$white"}}),Z=function(e){var t=e.css,n=e.profileImage,r=e.name,c=e.menuItems,a=(void 0===c?[]:c).map((function(e,t){return Object(T.jsx)(q,{onSelect:function(){return e.buttonAction()},children:e.buttonText},t)}));return Object(T.jsx)($,{css:t,children:Object(T.jsxs)(I.c,{children:[Object(T.jsx)(M,{size:"medium",imageSrc:n,name:r}),Object(T.jsxs)(Q,{children:[Object(T.jsx)(L,{bold:!0,css:{paddingRight:"$1"},children:r}),Object(T.jsx)(F,{icon:"chevronDown",fill:"#607283"})]}),Object(T.jsx)(V,{align:"end",children:a.length&&a})]})})},J=function(e){var t=e.currentUser,n=xt(),r=[{buttonText:"Logout",buttonAction:function(){pt(n)}}];return Object(T.jsx)($,{as:"header",css:{display:"flex",py:"$3",px:"$2",justifyContent:"flex-end"},children:Object(T.jsx)(Z,{profileImage:t.profileImage,name:t.name,menuItems:r})})},K=function(){var e=gt().currentUser;return e&&Object(T.jsx)(J,{currentUser:e})},X=function(e){var t=e.children,n=gt().isAuthenticated;return Object(T.jsxs)($,{css:{height:"100%",display:"flex",flexDirection:"column",maxWidth:"800px",mx:"auto"},children:[n?Object(T.jsx)(K,{}):null,Object(T.jsx)("main",{children:Object(T.jsx)($,{css:{height:"100%",px:"$3",paddingTop:"$5"},children:t})})]})},ee=function(){var e=localStorage.getItem("accessToken"),t="".concat("https://localhost:5001"),n=m.a.create({baseURL:t,withCredentials:!0,headers:{Authorization:"Bearer ".concat(e)}});return n.interceptors.response.use((function(e){return e}),function(){var e=Object(g.a)(j.a.mark((function e(r){var c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r.config,401!==r.response.status||c._retry){e.next=19;break}return c._retry=!0,e.prev=3,e.next=6,m.a.get("".concat(t,"/api/auth/refresh-tokens"),{withCredentials:!0});case 6:if(200!==(a=e.sent).status){e.next=12;break}return localStorage.setItem("accessToken",a.data.accessToken),localStorage.setItem("spotifyAccessToken",a.data.spotifyAccessToken),c.headers.Authorization="Bearer ".concat(a.data.accessToken),e.abrupt("return",n(c));case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(3),e.abrupt("return",Promise.reject(e.t0));case 17:e.next=20;break;case 19:401===r.response.status&&"api/auth/refresh-tokens"===r.response.url&&(window.location.href=Ke.LOGIN);case 20:return e.abrupt("return",Promise.reject(r));case 21:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()),n},te={logoutUser:function(){var e=Object(g.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ee().get("api/auth/logout"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRefreshSpotifyAccessToken:function(){var e=Object(g.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ee().get("/api/auth/refresh-spotify-token"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),postTrackToQueue:function(){var e=Object(g.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ee().post("/api/room/queue",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getRoomQueue:function(){var e=Object(g.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ee().get("/api/room/queue"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getCurrentlyPlaying:function(){var e=Object(g.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ee().get("/api/room/currently-playing"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};!function(e){e.UPDATE_USERS="update_users",e.UPDATE_QUEUE="update_queue",e.GET_QUEUE_SUCCESS="get_queue_success",e.UPDATE_CURRENTLY_PLAYING="update_currently_playing",e.GET_CURRENTLY_PLAYING_SUCCESS="get_currently_playing_success"}(h||(h={}));var ne,re,ce=function(){var e=Object(g.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:h.UPDATE_USERS,payload:n});case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ae=function(){var e=Object(g.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:h.UPDATE_QUEUE,payload:n});case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),oe=function(){var e=Object(g.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.getRoomQueue();case 2:return e.next=4,e.sent.data;case 4:n=e.sent,t({type:h.GET_QUEUE_SUCCESS,payload:n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=Object(g.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:h.UPDATE_CURRENTLY_PLAYING,payload:n});case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),se=function(){var e=Object(g.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.getCurrentlyPlaying();case 2:return e.next=4,e.sent.data;case 4:return n=e.sent,t({type:h.GET_CURRENTLY_PLAYING_SUCCESS,payload:n}),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(e){var t=Math.floor(e%36e5/6e4),n=Math.floor(e%36e4%6e4/1e3);return t+":"+(n<10?"0"+n:n)},le=C(R,{px:"$3",py:"$2",marginBottom:"$2",bd:"$grey400",transition:"0.25s","&:hover":{bd:"$grey300"}}),de=C($,{display:"grid",gridColumnGap:"$2",gridTemplateColumns:"20px 50px 1fr auto",backgroundColor:"$grey400",border:"none",width:"100%"}),pe=C("img",{height:"50px"}),he=C($,{display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"}),fe=C($,{display:"flex",alignItems:"center"}),be=C(R,{textAlign:"center"}),je=o.a.forwardRef((function(e,t){var n=e.tracks,r=Object(d.a)(e,["tracks"]),c=n.map((function(e,t){var n=ue(e.duration),r=t+1<10?"0"+(t+1):t+1;return Object(T.jsx)(le,{children:Object(T.jsxs)(de,{children:[Object(T.jsx)(fe,{children:Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:r})}),Object(T.jsx)(pe,{src:e.album.images[0].url}),Object(T.jsxs)(he,{children:[Object(T.jsx)(L,{size:"small",bold:!0,children:e.name}),Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:e.artists[0].name})]}),Object(T.jsx)(fe,{children:Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:n})})]})},e.id)}));return Object(T.jsx)($,Object(l.a)(Object(l.a)({},r),{},{children:n.length?Object(T.jsx)($,{children:c}):Object(T.jsx)(be,{children:Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:"Queue is empty."})})}))})),ge=function(e,t){switch(t.type){case h.UPDATE_USERS:return Object(l.a)(Object(l.a)({},e),{},{users:t.payload});case h.UPDATE_QUEUE:case h.GET_QUEUE_SUCCESS:return Object(l.a)(Object(l.a)({},e),{},{queue:t.payload});case h.UPDATE_CURRENTLY_PLAYING:case h.GET_CURRENTLY_PLAYING_SUCCESS:return Object(l.a)(Object(l.a)({},e),{},{currentlyPlaying:t.payload});default:throw new Error("Invalid action type")}},xe={users:[],queue:[],currentlyPlaying:{track:null,user:null,startedAt:0}},me=Object(a.createContext)(xe),Oe=Object(a.createContext)(void 0),ve=function(e){var t=e.children,n=Object(a.useReducer)(ge,xe),r=Object(p.a)(n,2),c=r[0],o=r[1];return Object(T.jsxs)(me.Provider,{value:c,children:[Object(T.jsx)(Oe.Provider,{value:o,children:t})," "]})},ye=function(){var e=Object(a.useContext)(me);if(void 0===e)throw new Error("useRoomState must be used within a RoomStateContext Provider");return e},Ce=function(){var e=Object(a.useContext)(Oe);if(void 0===e)throw new Error("useRoomDispatch must be used within a RoomDispatchContext Provider");return e},we=function(){var e=ye().queue,t=Ce();Object(a.useEffect)((function(){oe(t)}),[]);var n=e.map((function(e){return e.track}));return Object(T.jsx)(je,{tracks:n})},ke=k({"0%":{transform:"scale(0)"},"40%":{transform:"scale(1.0)"},"80%":{transform:"scale(0)"},"100%":{transform:"scale(0)"}}),$e=C("div",{width:"100%",textAlign:"center","& div":{width:"8px",height:"8px",backgroundColor:"$grey200",borderRadius:"100%",display:"inline-block",animation:"".concat(ke," 1.4s infinite ease-in-out both")}}),Te=C("div",{"&:nth-of-type(1)":{animationDelay:"-0.32s"},"&:nth-of-type(2)":{animationDelay:"-0.16s"}}),Se=function(){return Object(T.jsxs)($e,{children:[Object(T.jsx)(Te,{}),Object(T.jsx)(Te,{}),Object(T.jsx)(Te,{})]})},Ue=C($,{position:"absolute",width:"100%","&:before":{content:"",position:"absolute",width:"100%",height:"40px",zIndex:"1",bottom:"-35px",linearGradient:"180deg, rgba(13,18,23,1) 20%, rgba(13,18,23,0.8981792546120011) 40%, rgba(13,18,23,0.5844537644159227) 70%, rgba(13,18,23,0) 100%"}}),Ee=C("button",{backgroundColor:"$grey400",border:"none",padding:"$1",display:"flex",alignItems:"center",marginBottom:"$1",width:"100%",borderRadius:"$2",transition:"0.2s","&:hover":{backgroundColor:"$grey300",cursor:"pointer"}}),Re=C("img",{height:"40px"}),_e=C($,{display:"flex",width:"100%",px:"$2",flexDirection:"column",alignItems:"flex-start"}),Ae=o.a.forwardRef((function(e,t){var n,r=e.tracks,c=e.loading,a=void 0!==c&&c,o=e.handleTrackSelection,i=Object(d.a)(e,["tracks","loading","handleTrackSelection"]);return n=r.length?r.map((function(e){return Object(T.jsx)($,{children:Object(T.jsxs)(Ee,{onClick:function(){o(e.id)},children:[Object(T.jsx)(Re,{src:e.album.images[0].url}),Object(T.jsxs)(_e,{children:[Object(T.jsx)(L,{size:"small",children:e.name}),Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:e.artists[0].name})]}),Object(T.jsx)(F,{icon:"plus",fill:"#c9d6e2",css:{paddingRight:"$1"}})]})},e.id)})):Object(T.jsx)($,{css:{textAlign:"center",py:"$1"},children:Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:"No tracks found"})}),Object(T.jsx)(Ue,Object(l.a)(Object(l.a)({},i),{},{ref:t,children:Object(T.jsx)(R,{css:{position:"relative",padding:"$1",bd:"$grey300",maxHeight:"300px",overflowY:"scroll",zIndex:"1"},children:a?Object(T.jsx)(Se,{}):n})}))})),Pe=C($,{position:"relative"}),Le=C("input",{width:"100%",boxSizing:"border-box",fontWeight:"$regular",color:"$grey100",fontSize:"$small",lineHeight:"$small",backgroundColor:"$grey500",bd:"$grey300",paddingLeft:"$2",paddingTop:"$2",paddingBottom:"$2",paddingRight:"$2",borderRadius:"$1","&:focus":{outline:"none",borderColor:"$accent200"},"&::placeholder":{color:"$grey200"},variants:{showIcon:{true:{paddingRight:"$5"}}}}),Ie=C(F,{position:"absolute",right:"$2",top:"50%",transform:"translateY(-50%)"}),De=o.a.forwardRef((function(e,t){var n=e.icon,r=e.iconFill,c=e.showIcon,a=Object(d.a)(e,["icon","iconFill","showIcon"]);return Object(T.jsxs)(Pe,{children:[Object(T.jsx)(Le,Object(l.a)(Object(l.a)({showIcon:c},a),{},{ref:t})),c&&Object(T.jsx)(Ie,{icon:n,fill:r})]})})),ze=function(){var e=gt().currentUser,t=Object(a.useState)(""),n=Object(p.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)(!1),i=Object(p.a)(o,2),s=i[0],u=i[1],l=Object(a.useState)([]),d=Object(p.a)(l,2),h=d[0],f=d[1],b=function(e){var t=Object(a.useState)(e),n=Object(p.a)(t,2),r=n[0],c=n[1],o=Object(a.useRef)(null),i=function(e){o.current&&!o.current.contains(e.target)&&c(!1)};return Object(a.useEffect)((function(){return document.addEventListener("click",i,!0),function(){document.removeEventListener("click",i,!0)}}),[]),{ref:o,isVisible:r,setIsVisible:c}}(!1),x=b.ref,O=b.isVisible,v=b.setIsVisible;Object(a.useEffect)((function(){if(!r)return f([]);var e=m.a.CancelToken.source(),t=e.token;return function(){var e=Object(g.a)(j.a.mark((function e(){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u(!0),e.next=4,lt.getTrackBySearchTerm(r,t);case 4:n=e.sent,f(n),u(!1),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),f([]);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}()(),function(){return e.cancel()}}),[r]);return Object(T.jsxs)("div",{children:[Object(T.jsx)(De,{value:r,placeholder:"Add a track to the queue",onChange:function(e){return c(e.target.value)},onClick:function(e){return v(!0)},showIcon:!0,icon:"spyGlass",iconFill:"#607283"}),r&&O&&Object(T.jsx)($,{css:{position:"relative",marginTop:"$1"},children:Object(T.jsx)(Ae,{tracks:h,loading:s,handleTrackSelection:function(t){var n={track:h.find((function(e){return e.id===t})),user:e};te.postTrackToQueue(n),v(!1),c("")},ref:x})})]})},Ge=function(e,t){var n=Object(a.useState)(0),r=Object(p.a)(n,2),c=r[0],o=r[1],i=Object(a.useState)(0),s=Object(p.a)(i,2),u=s[0],l=s[1],d=Object(a.useState)("0:00"),h=Object(p.a)(d,2),f=h[0],b=h[1],j=t+e,g=function(){var t=j-Date.now();if(t>0){var n=e-t,r=n/e*100;o(n),b(ue(n)),l(r)}else o(0),b("0:00"),l(0)};return Object(a.useEffect)((function(){var e=setInterval(g,1e3);return function(){clearInterval(e)}}),[t]),{currentPositionMs:c,currentPositionMin:f,playbackPercent:u}},Ne=C($,{display:"grid",gridColumnGap:"$3",gridTemplateColumns:"120px auto"}),Be=C("img",{width:"120px"}),He=C($,{display:"grid",gridColumnGap:"$2",gridTemplateColumns:"auto 50px"}),Me=C($,{display:"flex",flexDirection:"column",justifyContent:"center",paddingTop:"$3"}),We=C($,{width:"100%",height:"3px",backgroundColor:"$grey300",position:"relative",marginBottom:"$2",overflow:"hidden",borderRadius:"$2"}),Ye=C($,{backgroundColor:"$accent200",height:"3px",width:"100%",position:"absolute",left:"-100%",borderRadius:"$2"}),Fe=C($,{display:"flex",justifyContent:"space-between"}),Qe=C(R,{textAlign:"center"}),Ve=C("button",{backgroundColor:"transparent",padding:"$2",bd:"$grey300",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",height:"auto",width:"auto",cursor:"pointer",marginTop:"$3",transition:"0.15s","&:hover":{bd:"$grey200"}}),qe=o.a.forwardRef((function(e,t){var n=e.currentlyPlaying,r=e.paused,c=e.onControlClick,a=Object(d.a)(e,["currentlyPlaying","paused","onControlClick"]),o=n.track,i=n.user,s=n.startedAt,u=(null===o||void 0===o?void 0:o.duration)?null===o||void 0===o?void 0:o.duration:0,p=Ge(u,s),h=p.currentPositionMin,f=p.playbackPercent;return Object(T.jsx)($,Object(l.a)(Object(l.a)({},a),{},{children:o?Object(T.jsx)(R,{css:{padding:"$2"},children:Object(T.jsxs)(Ne,{children:[Object(T.jsx)(Be,{src:null===o||void 0===o?void 0:o.album.images[0].url}),Object(T.jsxs)($,{css:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[Object(T.jsxs)(He,{children:[Object(T.jsxs)($,{children:[Object(T.jsx)(L,{css:{color:"$grey200"},children:null===o||void 0===o?void 0:o.artists[0].name}),Object(T.jsx)(A,{size:"h2",children:null===o||void 0===o?void 0:o.name}),Object(T.jsxs)(L,{size:"small",css:{color:"$grey200"},children:["Queued by ",null===i||void 0===i?void 0:i.name]})]}),Object(T.jsx)($,{css:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:Object(T.jsx)(Ve,{onClick:function(){return c()},children:Object(T.jsx)(F,{icon:r?"play":"pause",fill:"#c9d6e2"})})})]}),Object(T.jsxs)(Me,{children:[Object(T.jsx)(We,{children:Object(T.jsx)(Ye,{css:{left:"-".concat(100-f,"%")}})}),Object(T.jsxs)(Fe,{children:[Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:h}),Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:ue(u)})]})]})]})]})}):Object(T.jsx)(Qe,{children:Object(T.jsx)(L,{size:"small",css:{color:"$grey200"},children:"No tracks are currently queued."})})}))})),Ze=function(){var e,t=ye().currentlyPlaying,n=Ce(),r=localStorage.getItem("spotifyAccessToken"),c=Object(a.useState)(!1),o=Object(p.a)(c,2),i=o[0],s=o[1],u=Object(a.useState)(null),l=Object(p.a)(u,2),d=l[0],h=l[1],f=Object(a.useState)(!0),b=Object(p.a)(f,2),x=b[0],m=b[1],O=t.track,v=t.startedAt,y=(null===O||void 0===O?void 0:O.duration)?null===O||void 0===O?void 0:O.duration:0,C=Ge(y,v).currentPositionMs;Object(a.useEffect)((function(){return Object(g.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.onSpotifyWebPlaybackSDKReady?k():window.onSpotifyWebPlaybackSDKReady=k,w(),se(n);case 3:case"end":return e.stop()}}),e)})))(),function(){e.disconnect()}}),[r]),Object(a.useEffect)((function(){i&&O&&(x?lt.pausePlayback(d):lt.startPlayback(O.id,C,d))}),[x,t]);var w=function(){return new Promise((function(e,t){if(document.getElementById("spotify-player"))e();else{var n=document.createElement("script");n.id="spotify-player",n.type="text/javascript",n.async=!1,n.defer=!0,n.src="https://sdk.scdn.co/spotify-player.js",n.onload=function(){return e()},n.onerror=function(e){return t(new Error("Failed to load script: ".concat(e)))},document.head.appendChild(n)}}))},k=function(){(e=new window.Spotify.Player({name:"Rooms",getOAuthToken:function(e){e(r)}})).addListener("initialization_error",(function(e){var t=e.message;console.error(t)})),e.addListener("authentication_error",Object(g.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.getRefreshSpotifyAccessToken();case 2:t=e.sent,localStorage.setItem("spotifyAccessToken",t.data.accessToken),r=t.data.accessToken;case 5:case"end":return e.stop()}}),e)})))),e.addListener("account_error",(function(e){var t=e.message;console.error(t)})),e.addListener("playback_error",(function(e){var t=e.message;console.error(t)})),e.addListener("player_state_changed",(function(e){e&&m(e.paused)})),e.addListener("ready",(function(e){var t=e.device_id;console.log("Ready with Device ID",t),h(t),s(!0)})),e.addListener("not_ready",(function(e){var t=e.device_id;console.log("Device ID has gone offline",t),s(!1)})),e.connect()};return Object(T.jsx)(qe,{currentlyPlaying:t,paused:x,onControlClick:function(){i&&m(!x)}})},Je=n(49);!function(e){e.UPDATE_USERS="UpdateUsers",e.DISCONNECTED="disconnected",e.UPDATE_QUEUE="UpdateQueue",e.UPDATE_CURRENTLY_PLAYING="UpdateCurrentlyPlaying"}(ne||(ne={})),function(e){e.JOIN_ROOM="JoinRoom"}(re||(re={}));var Ke,Xe=Object(a.createContext)(void 0),et=function(e){var t=e.children,n=gt().currentUser,r=Ce(),c=Object(a.useRef)(null),o=function(){var e=Object(g.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===c.current){e.next=3;break}return e.next=3,c.current.stop();case 3:return c.current=(new Je.a).withUrl(t).withAutomaticReconnect().build(),e.next=6,c.current.start();case 6:return e.next=8,c.current.send("Connect");case 8:c.current.on("Connected",(function(e){console.log(e)})),c.current.send(re.JOIN_ROOM,n),c.current.on(ne.UPDATE_USERS,(function(e){ce(r,e)})),c.current.on(ne.UPDATE_CURRENTLY_PLAYING,(function(e){ie(r,e)})),c.current.on(ne.UPDATE_QUEUE,(function(e){ae(r,e)}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i={socket:c,connect:o};return Object(T.jsx)(Xe.Provider,{value:i,children:t})},tt=C($,{display:"grid",gridColumnGap:"$5",gridTemplateColumns:"1fr 3fr"}),nt=C($,{}),rt=C($,{}),ct=C($,{display:"flex",alignItems:"center"}),at=function(e){var t=e.users;return Object(T.jsx)($,{children:t.map((function(e){return Object(T.jsxs)(ct,{css:{marginTop:"$4","&:first-of-type":{marginTop:"0px"}},children:[Object(T.jsx)(M,{imageSrc:e.profileImage,name:e.name,status:!0}),Object(T.jsx)(L,{css:{paddingLeft:"$3"},size:"small",bold:!0,children:e.name})]},e.userId)}))})},ot=function(){var e=ye().users;return Object(T.jsxs)($,{children:[Object(T.jsx)(A,{size:"h2",css:{marginBottom:"$2"},children:"People"}),Object(T.jsxs)(L,{css:{color:"$grey200",marginBottom:"$3"},children:["Online (",e.length,")"]}),Object(T.jsx)(at,{users:e})]})},it=function(){var e=function(){var e=Object(a.useContext)(Xe);if(void 0===e)throw new Error("useSocketConnection must be used within a SocketConnectionContext Provider");return e}(),t="".concat("https://localhost:5001","/hubs/room");return Object(a.useEffect)((function(){return e.connect(t),function(){var t;null===(t=e.socket.current)||void 0===t||t.stop()}}),[]),Object(T.jsx)(X,{children:Object(T.jsxs)(tt,{children:[Object(T.jsx)(nt,{children:Object(T.jsx)(ot,{})}),Object(T.jsxs)(rt,{children:[Object(T.jsx)(A,{size:"h2",css:{marginBottom:"$2"},children:"Now Playing"}),Object(T.jsx)($,{css:{marginBottom:"$4"},children:Object(T.jsx)(Ze,{})}),Object(T.jsx)($,{css:{marginBottom:"$4"},children:Object(T.jsx)(ze,{})}),Object(T.jsx)(A,{size:"h2",css:{marginBottom:"$2"},children:"Up Next"}),Object(T.jsx)(we,{})]})]})})};!function(e){e.NOT_FOUND="*",e.LOGIN="/login",e.DASHBOARD="/dashboard"}(Ke||(Ke={}));var st=[{path:Ke.LOGIN,component:function(){var e=gt().isAuthenticated,t=Object(u.g)();Object(a.useEffect)((function(){e&&t.push(Ke.DASHBOARD)}),[]);return Object(T.jsx)(X,{children:Object(T.jsx)($,{css:{display:"flex",height:"100%",justifyContent:"center",alignItems:"center"},children:Object(T.jsxs)(R,{css:{display:"inline-block",textAlign:"center",px:"$4",maxWidth:"350px"},children:[Object(T.jsx)(A,{size:"h1",css:{marginBottom:"$1"},children:"Rooms \ud83d\udc83"}),Object(T.jsx)(L,{size:"paragraph",css:{marginBottom:"$5",color:"$grey200"},children:"Sign in via Spotify and stream your favourite songs together."}),Object(T.jsx)(U,{fullWidth:!0,onClick:function(){return location.href="".concat("https://localhost:5001","/api/auth/login")},children:"Login via Spotify"})]})})})},isPrivate:!1},{path:Ke.DASHBOARD,component:it,isPrivate:!0},{path:Ke.NOT_FOUND,component:it,isPrivate:!0,exact:!0}],ut=function(){var e=localStorage.getItem("spotifyAccessToken"),t="".concat("https://localhost:5001"),n=m.a.create({baseURL:"https://api.spotify.com/v1",headers:{Authorization:"Bearer ".concat(e)}});return n.interceptors.response.use((function(e){return e}),function(){var e=Object(g.a)(j.a.mark((function e(r){var c,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r.config,401!==r.response.status||c._retry){e.next=19;break}return c._retry=!0,e.prev=3,e.next=6,m.a.get("".concat(t,"/api/auth/refresh-tokens"),{withCredentials:!0});case 6:if(200!==(a=e.sent).status){e.next=12;break}return localStorage.setItem("accessToken",a.data.accessToken),localStorage.setItem("spotifyAccessToken",a.data.spotifyAccessToken),c.headers.Authorization="Bearer ".concat(a.data.accessToken),e.abrupt("return",n(c));case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(3),e.abrupt("return",Promise.reject(e.t0));case 17:e.next=20;break;case 19:401===r.response.status&&"api/auth/refresh-tokens"===r.response.url&&(window.location.href=Ke.LOGIN);case 20:return e.abrupt("return",Promise.reject(r));case 21:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()),n},lt={getTrackBySearchTerm:function(){var e=Object(g.a)(j.a.mark((function e(t,n){var r,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 10,"track",r=[],e.prev=3,e.next=6,ut().get("search?q=".concat(t,"&type=").concat("track","&limit=").concat(10),{cancelToken:n});case 6:c=e.sent,r=c.data.tracks.items.map((function(e){var t=e.artists.map((function(e){return{id:e.id,name:e.name}})),n={id:e.album.id,name:e.album.name,images:e.album.images};return{id:e.id,name:e.name,duration:e.duration_ms,artists:t,album:n}})),e.next=14;break;case 10:if(e.prev=10,e.t0=e.catch(3),!m.a.isCancel(e.t0)){e.next=14;break}return e.abrupt("return",Promise.resolve(e.t0));case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t,n){return e.apply(this,arguments)}}(),startPlayback:function(){var e=Object(g.a)(j.a.mark((function e(t,n,r){var c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={uris:["spotify:track:".concat(t)],position_ms:n},e.prev=1,e.next=4,ut().put("me/player/play?device_id=".concat(r),c);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.log(e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n,r){return e.apply(this,arguments)}}(),pausePlayback:function(){var e=Object(g.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ut().put("me/player/pause?device_id=".concat(t),{});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),getCurrentUserDetails:function(){var e=Object(g.a)(j.a.mark((function e(){var t,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ut().get("me");case 3:return t=e.sent,n={userId:t.data.id,name:t.data.display_name,profileImage:t.data.images[0].url},e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",Promise.reject(e.t0));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},dt=function(){var e=Object(g.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:r.AUTH_ATTEMPT}),e.next=4,lt.getCurrentUserDetails();case 4:n=e.sent,t({type:r.AUTH_SUCCESS,payload:n}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t({type:r.AUTH_ERROR});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=Object(g.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:r.LOGOUT_ATTEMPT}),e.next=4,te.logoutUser();case 4:localStorage.removeItem("accessToken"),localStorage.removeItem("spotifyAccessToken"),t({type:r.LOGOUT_SUCCESS}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t({type:r.LOGOUT_ERROR});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),ht={isLoading:!0,isAuthenticated:!1,currentUser:null},ft=Object(a.createContext)(ht),bt=Object(a.createContext)(void 0),jt=function(e){var t=e.children,n=Object(a.useReducer)(f,ht),r=Object(p.a)(n,2),c=r[0],o=r[1],i=Object(u.h)().search;return Object(a.useEffect)((function(){var e=new URLSearchParams(i).get("accessToken"),t=new URLSearchParams(i).get("spotifyAccessToken");e&&localStorage.setItem("accessToken",e),t&&localStorage.setItem("spotifyAccessToken",t),dt(o)}),[]),Object(T.jsxs)(ft.Provider,{value:c,children:[Object(T.jsx)(bt.Provider,{value:o,children:c.isLoading?Object(T.jsx)($,{}):t})," "]})},gt=function(){var e=Object(a.useContext)(ft);if(void 0===e)throw new Error("useAuthenticationState must be used within a AuthenticationStateContext Provider");return e},xt=function(){var e=Object(a.useContext)(bt);if(void 0===e)throw new Error("useAuthenticationDispatch must be used within a AuthenticationDispatchContext Provider");return e},mt=function(e){var t=e.path,n=e.component,r=e.isPrivate,c=Object(d.a)(e,["path","component","isPrivate"]),a=gt().isAuthenticated;return Object(T.jsx)(u.b,Object(l.a)(Object(l.a)({path:t},c),{},{children:r&&!a?Object(T.jsx)(u.a,{to:{pathname:Ke.LOGIN}}):Object(T.jsx)(n,{})}))},Ot=w({"@import":["'https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap'"],"*":{fontFamily:"Heebo"},"body, h1, h2, h3, h4, p, figure, blockquote, dl, dd":{margin:"0px"},body:{backgroundColor:"$grey500",textRendering:"optimizeSpeed"},"html, body, main, #root":{height:"100%"}});var vt=function(){return Ot(),Object(T.jsx)(jt,{children:Object(T.jsx)(ve,{children:Object(T.jsx)(et,{children:Object(T.jsx)(u.d,{children:st.map((function(e){return Object(T.jsx)(mt,{path:e.path,component:e.component,isPrivate:e.isPrivate},e.path)}))})})})})},yt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,86)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};s.a.render(Object(T.jsx)(o.a.StrictMode,{children:Object(T.jsx)(c.a,{children:Object(T.jsx)(vt,{})})}),document.getElementById("root")),yt()}},[[83,1,2]]]);
//# sourceMappingURL=main.9f34b787.chunk.js.map